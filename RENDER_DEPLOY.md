# ğŸš€ Render Deployment Fix Guide

## âŒ Eroarea IniÈ›ialÄƒ

```
tsconfig.json(7,35): error TS5096: Option 'allowImportingTsExtensions' can only be used when either 'noEmit' or 'emitDeclarationOnly' is set.
==> Build failed ğŸ˜
```

---

## âœ… Fix Aplicat

### **server/tsconfig.json** - Configurat pentru Production Build

**Ãnainte:**
```json
{
  "compilerOptions": {
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,  // âŒ Incompatibil cu emit
    "noEmit": false,
    ...
  }
}
```

**DupÄƒ:**
```json
{
  "compilerOptions": {
    "moduleResolution": "node",  // âœ… Standard pentru Node.js
    // Removed: allowImportingTsExtensions
    // Removed: noEmit (default false)
    "outDir": "./dist",
    "rootDir": "./src",
    ...
  }
}
```

**De ce funcÈ›ioneazÄƒ:**
- Am eliminat `allowImportingTsExtensions` pentru cÄƒ **deja am adÄƒugat extensia `.js`** la toate importurile
- Schimbat `moduleResolution` din `"bundler"` Ã®n `"node"` pentru compatibilitate Node.js
- TypeScript va compila corect fiÈ™ierele `.ts` â†’ `.js` Ã®n `dist/`

---

## ğŸ“‹ Configurare Render

### **1. Root Directory**
```
Root Directory: server
```

### **2. Build Command**
```bash
npm install && npm run build
```

### **3. Start Command**
```bash
npm start
```

### **4. Environment Variables**

SeteazÄƒ Ã®n Render Dashboard â†’ Environment:

```bash
# Database (CRITICAL!)
DATABASE_URL=postgresql://user:pass@host.neon.tech/db?sslmode=require
DIRECT_DATABASE_URL=postgresql://user:pass@host.neon.tech/db?sslmode=require

# Redis (Upstash)
REDIS_URL=rediss://default:pass@host.upstash.io:6379

# Solana RPC
SOLANA_RPC_URL=https://api.devnet.solana.com

# Development Wallet (pentru pool operations)
DEV_WALLET_PRIVATE_KEY=your_base58_private_key_here

# Treasury Wallet
TREASURY_WALLET_PUBKEY=your_treasury_public_key

# Frontend URL (CORS)
FRONTEND_URL=https://your-frontend.vercel.app

# Node Environment
NODE_ENV=production

# Port (Render sets this automatically)
PORT=5000

# Optional - Sentry
SENTRY_DSN=your_sentry_dsn_here

# Optional - Switchboard (pentru randomness)
SWITCHBOARD_PROGRAM_ID=Aio4gaXjXNVLtzwtNVmSqGKpANtXhybbkhtAC94ji2
SWITCHBOARD_QUEUE=EYiAmGSdsQTuCw413V5BzaruWuCCSDgTPtBGvLkXHbe7
```

### **5. Health Check Path**
```
/health
```

---

## ğŸ” Verificare Build Local (OpÈ›ional)

DacÄƒ vrei sÄƒ testezi build-ul local Ã®nainte de deploy:

```bash
cd ~/missout/server

# Clean build
rm -rf dist

# Build
npx tsc

# VerificÄƒ output
ls -la dist/

# Test start
node dist/index.js
```

---

## ğŸ¯ DupÄƒ Deploy pe Render

### **1. VerificÄƒ Logs**
Ãn Render Dashboard â†’ Logs, ar trebui sÄƒ vezi:

```
[ENV] âœ… Production mode - using system environment variables
[SECURITY] âœ… CORS enabled for origin: https://your-frontend.vercel.app
[MONITOR] âœ… Solana services initialized
[express] serving on port 5000
info: Server started successfully
```

### **2. TesteazÄƒ Health Endpoint**
```bash
curl https://your-backend.onrender.com/health
```

RÄƒspuns aÈ™teptat:
```json
{
  "status": "healthy",
  "timestamp": "2026-01-10T...",
  "database": "connected",
  "redis": { "connected": true, ... },
  "rpc": { "connected": true, ... },
  "poolMonitor": { "running": true }
}
```

### **3. TesteazÄƒ API Pools**
```bash
curl https://your-backend.onrender.com/api/pools
```

RÄƒspuns aÈ™teptat:
```json
{
  "data": [],
  "pagination": { "page": 1, "limit": 20, ... }
}
```

---

## ğŸ› Troubleshooting

### **Build Failed: "Cannot find module '@shared/schema'"**

**CauzÄƒ:** Paths nu sunt rezolvate corect Ã®n production.

**Fix:** AsigurÄƒ-te cÄƒ Ã®n `tsconfig.json` ai:
```json
{
  "include": [
    "src/**/*",
    "../shared/**/*"  // âœ… Include shared
  ]
}
```

---

### **Runtime Error: "Cannot find module '../shared/schema.js'"**

**CauzÄƒ:** Shared files nu sunt copiate Ã®n dist.

**Fix:** VerificÄƒ `package.json` â†’ scripts:
```json
{
  "scripts": {
    "build": "tsc && npm run copy-files",
    "copy-files": "mkdir -p dist && cp -r ../shared dist/ || true"
  }
}
```

---

### **Database Connection Timeout**

**CauzÄƒ:** `DATABASE_URL` nu este setat sau SSL nu funcÈ›ioneazÄƒ.

**Fix:**
1. VerificÄƒ cÄƒ `DATABASE_URL` este setat Ã®n Render Environment
2. AsigurÄƒ-te cÄƒ URL-ul conÈ›ine `?sslmode=require`

---

### **CORS Error Ã®n Frontend**

**CauzÄƒ:** `FRONTEND_URL` nu este setat corect.

**Fix:** SeteazÄƒ Ã®n Render:
```bash
FRONTEND_URL=https://your-frontend.vercel.app
```

FÄƒrÄƒ trailing slash!

---

## ğŸ“ Structura DupÄƒ Build

```
server/
â”œâ”€â”€ dist/                    # âœ… Generated by tsc
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ routes.js
â”‚   â”œâ”€â”€ db.js
â”‚   â”œâ”€â”€ pool-monitor/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/                     # Source TypeScript
â”œâ”€â”€ node_modules/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json            # âœ… FIXED
â””â”€â”€ drizzle.config.ts
```

---

## âœ… Checklist Final

Ãnainte de deploy, verificÄƒ:

- [ ] `server/tsconfig.json` - `moduleResolution: "node"`, fÄƒrÄƒ `allowImportingTsExtensions`
- [ ] Toate importurile au extensia `.js` (nu `.ts`)
- [ ] `DATABASE_URL` setat Ã®n Render Environment
- [ ] `REDIS_URL` setat Ã®n Render Environment
- [ ] `FRONTEND_URL` setat corect
- [ ] `DEV_WALLET_PRIVATE_KEY` setat
- [ ] `NODE_ENV=production` setat
- [ ] Build command: `npm install && npm run build`
- [ ] Start command: `npm start`
- [ ] Root directory: `server`
- [ ] Health check path: `/health`

---

## ğŸ‰ Deploy-ul ar Trebui SÄƒ MeargÄƒ Acum!

DupÄƒ ce ai fixat `tsconfig.json`, push la GitHub È™i Render va rebuilda automat:

```bash
cd ~/missout
git add server/tsconfig.json
git commit -m "fix: update tsconfig for production build"
git push origin main
```

Render va detecta push-ul È™i va rula build-ul din nou! ğŸš€
